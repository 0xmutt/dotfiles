#!/bin/bash
#
# This script scans your Dropbox (or any given folder) for folders stored
# in the `ignore` array and excludes them from syncing.
# 
# Based on script by Jan T. Sott:
#   https://gist.github.com/idleberg/6c8a563e248103baaa20

set -e

# SETTINGS
# ========

# Location of your Dropbox folder
dropbox_folder="$HOME/Dropbox"
# Array of folders to ignore
ignore_list=['bower_components','node_modules']

function recurse() {
 for i in "$1"/*; do
  if [ -d "$i" ]; then
    j=$(basename "$i")
    if [[ " ${ignore_list[*]} " == *$j* ]]; then
      dropbox exclude add "$i" && echo "Added $i"
      continue
    fi
    recurse "$i"
  fi
 done
}

# SCRIPT
# ======

if [[ -n $1 && -d $1 ]] ; then
  dropbox_folder=$1
else
  # Check Dropbox folder location
  if [[ -d "$dropbox_folder" || -h "$dropbox_folder" ]]; then
    echo "Dropbox found at $dropbox_folder"
  else
    echo "Dropbox not found."
    exit 1
  fi
fi

if hash dropbox 2>/dev/null ; then
  recurse $dropbox_folder
else
  echo "Dropbox wasn't installed."
fi
